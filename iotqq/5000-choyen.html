<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>5000 choyen 字体生成器 | opqqq-plugin</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/opqqq-plugin-press/logo.png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/react-toastify@7.0.3/dist/ReactToastify.min.css">
    <meta name="description" content="基于 opqqq 的插件使用说明">
    
    <link rel="preload" href="/opqqq-plugin-press/assets/css/0.styles.361c21fa.css" as="style"><link rel="preload" href="/opqqq-plugin-press/assets/js/app.0581ffdb.js" as="script"><link rel="preload" href="/opqqq-plugin-press/assets/js/2.ca183b19.js" as="script"><link rel="preload" href="/opqqq-plugin-press/assets/js/12.5917bece.js" as="script"><link rel="prefetch" href="/opqqq-plugin-press/assets/js/10.911e7301.js"><link rel="prefetch" href="/opqqq-plugin-press/assets/js/11.5bc0c6fe.js"><link rel="prefetch" href="/opqqq-plugin-press/assets/js/13.ada47f7f.js"><link rel="prefetch" href="/opqqq-plugin-press/assets/js/14.b78bc736.js"><link rel="prefetch" href="/opqqq-plugin-press/assets/js/15.0a2dc9e9.js"><link rel="prefetch" href="/opqqq-plugin-press/assets/js/16.1900b7d0.js"><link rel="prefetch" href="/opqqq-plugin-press/assets/js/17.04f2bb47.js"><link rel="prefetch" href="/opqqq-plugin-press/assets/js/18.a456d7e2.js"><link rel="prefetch" href="/opqqq-plugin-press/assets/js/19.101e4efa.js"><link rel="prefetch" href="/opqqq-plugin-press/assets/js/20.440c8953.js"><link rel="prefetch" href="/opqqq-plugin-press/assets/js/3.e0e7d2a9.js"><link rel="prefetch" href="/opqqq-plugin-press/assets/js/4.dc1b8ac6.js"><link rel="prefetch" href="/opqqq-plugin-press/assets/js/5.75b45a3a.js"><link rel="prefetch" href="/opqqq-plugin-press/assets/js/6.4db4b8c2.js"><link rel="prefetch" href="/opqqq-plugin-press/assets/js/7.5e42536a.js"><link rel="prefetch" href="/opqqq-plugin-press/assets/js/8.4c346502.js"><link rel="prefetch" href="/opqqq-plugin-press/assets/js/9.ac300af5.js">
    <link rel="stylesheet" href="/opqqq-plugin-press/assets/css/0.styles.361c21fa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/opqqq-plugin-press/" class="home-link router-link-active"><!----> <span class="site-name">opqqq-plugin</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/opqqq-plugin-press/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/opqqq-plugin-press/guide/manual.html" class="nav-link">
  从零开始
</a></div><div class="nav-item"><a href="/opqqq-plugin-press/guide/guide.html" class="nav-link">
  了解基础
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="插件说明" class="dropdown-title"><span class="title">插件说明</span> <span class="arrow down"></span></button> <button type="button" aria-label="插件说明" class="mobile-dropdown-title"><span class="title">插件说明</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/opqqq-plugin-press/iotqq/image-custom.html" class="nav-link">
  自定义表情包
</a></li><li class="dropdown-item"><!----> <a href="/opqqq-plugin-press/iotqq/good-morning.html" class="nav-link">
  关注早晚安
</a></li><li class="dropdown-item"><!----> <a href="/opqqq-plugin-press/iotqq/vtuber-fortune.html" class="nav-link">
  Vtuber / Pcr / 原神 运势
</a></li><li class="dropdown-item"><!----> <a href="/opqqq-plugin-press/iotqq/throw-creep.html" class="nav-link">
  可以爬了吗
</a></li><li class="dropdown-item"><!----> <a href="/opqqq-plugin-press/iotqq/sign-in.html" class="nav-link">
  Strings 签到
</a></li><li class="dropdown-item"><!----> <a href="/opqqq-plugin-press/iotqq/5000-choyen.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  5000 兆元字体生成器
</a></li></ul></div></div><div class="nav-item"><a href="/opqqq-plugin-press/other/other.html" class="nav-link">
  其他
</a></div><div class="nav-item"><a href="/opqqq-plugin-press/other/join.html" class="nav-link">
  加入我们
</a></div><div class="nav-item"><a href="https://github.com/opq-osc/opqqq-plugin" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/opqqq-plugin-press/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/opqqq-plugin-press/guide/manual.html" class="nav-link">
  从零开始
</a></div><div class="nav-item"><a href="/opqqq-plugin-press/guide/guide.html" class="nav-link">
  了解基础
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="插件说明" class="dropdown-title"><span class="title">插件说明</span> <span class="arrow down"></span></button> <button type="button" aria-label="插件说明" class="mobile-dropdown-title"><span class="title">插件说明</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/opqqq-plugin-press/iotqq/image-custom.html" class="nav-link">
  自定义表情包
</a></li><li class="dropdown-item"><!----> <a href="/opqqq-plugin-press/iotqq/good-morning.html" class="nav-link">
  关注早晚安
</a></li><li class="dropdown-item"><!----> <a href="/opqqq-plugin-press/iotqq/vtuber-fortune.html" class="nav-link">
  Vtuber / Pcr / 原神 运势
</a></li><li class="dropdown-item"><!----> <a href="/opqqq-plugin-press/iotqq/throw-creep.html" class="nav-link">
  可以爬了吗
</a></li><li class="dropdown-item"><!----> <a href="/opqqq-plugin-press/iotqq/sign-in.html" class="nav-link">
  Strings 签到
</a></li><li class="dropdown-item"><!----> <a href="/opqqq-plugin-press/iotqq/5000-choyen.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  5000 兆元字体生成器
</a></li></ul></div></div><div class="nav-item"><a href="/opqqq-plugin-press/other/other.html" class="nav-link">
  其他
</a></div><div class="nav-item"><a href="/opqqq-plugin-press/other/join.html" class="nav-link">
  加入我们
</a></div><div class="nav-item"><a href="https://github.com/opq-osc/opqqq-plugin" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>5000 choyen 字体生成器</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/opqqq-plugin-press/iotqq/5000-choyen.html#使用前注意" class="sidebar-link">使用前注意</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/opqqq-plugin-press/iotqq/5000-choyen.html#_5000-choyen-字体是什么" class="sidebar-link">5000 choyen 字体是什么</a></li><li class="sidebar-sub-header"><a href="/opqqq-plugin-press/iotqq/5000-choyen.html#我有更便捷的选择吗" class="sidebar-link">我有更便捷的选择吗</a></li></ul></li><li><a href="/opqqq-plugin-press/iotqq/5000-choyen.html#部署" class="sidebar-link">部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/opqqq-plugin-press/iotqq/5000-choyen.html#服务端部署" class="sidebar-link">服务端部署</a></li><li class="sidebar-sub-header"><a href="/opqqq-plugin-press/iotqq/5000-choyen.html#python-插件部署" class="sidebar-link">python 插件部署</a></li></ul></li><li><a href="/opqqq-plugin-press/iotqq/5000-choyen.html#自定义配置项" class="sidebar-link">自定义配置项</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/opqqq-plugin-press/iotqq/5000-choyen.html#如何配置触发命令" class="sidebar-link">如何配置触发命令</a></li><li class="sidebar-sub-header"><a href="/opqqq-plugin-press/iotqq/5000-choyen.html#如何修改图片格式" class="sidebar-link">如何修改图片格式</a></li></ul></li><li><a href="/opqqq-plugin-press/iotqq/5000-choyen.html#其他" class="sidebar-link">其他</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/opqqq-plugin-press/iotqq/5000-choyen.html#注意风控" class="sidebar-link">注意风控</a></li><li class="sidebar-sub-header"><a href="/opqqq-plugin-press/iotqq/5000-choyen.html#安装过程问题太多搞不明白了" class="sidebar-link">安装过程问题太多搞不明白了</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_5000-choyen-字体生成器"><a href="#_5000-choyen-字体生成器" class="header-anchor">#</a> 5000 choyen 字体生成器</h1> <p><em>Version: beta</em></p> <h2 id="使用前注意"><a href="#使用前注意" class="header-anchor">#</a> 使用前注意</h2> <h3 id="_5000-choyen-字体是什么"><a href="#_5000-choyen-字体是什么" class="header-anchor">#</a> 5000 choyen 字体是什么</h3> <p>详见 <a href="https://github.com/fz6m/5000choyen-server" target="_blank" rel="noopener noreferrer">5000choyen-server<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ，是一种特殊风格的字体。</p> <p>利用这个 nodejs 服务端，可以在本地请求生成该字体的图片，再通过 python 转发。</p> <h3 id="我有更便捷的选择吗"><a href="#我有更便捷的选择吗" class="header-anchor">#</a> 我有更便捷的选择吗</h3> <h4 id="为什么要使用-nodejs-作为服务端"><a href="#为什么要使用-nodejs-作为服务端" class="header-anchor">#</a> 为什么要使用 nodejs 作为服务端</h4> <p>因为核心绘图部分是使用网页中的 canvas 进行层叠渐变渲染堆出来的，所以需要使用 JavaScript 作为编程语言生成这种字体的图片。</p> <h4 id="使用-python-原生不可以实现吗"><a href="#使用-python-原生不可以实现吗" class="header-anchor">#</a> 使用 python 原生不可以实现吗</h4> <p>可以。但是无法完全复现一样具有冲击的效果，所以此路否决。</p> <h4 id="使用此功能我需要承担什么成本"><a href="#使用此功能我需要承担什么成本" class="header-anchor">#</a> 使用此功能我需要承担什么成本</h4> <p>需要在本地安装好 nodejs 环境，并部署好该项目。</p> <p>每次调用时，python 会去本地请求该服务端的地址，并将生成的图片获取到本地保存，再发往机器人主端外送消息。</p> <p>由 v8 引擎驱动的 nodejs 是很快的（ 比 python 要快 ），所以从请求获取图片再到发送，整个过程是非常快的。</p> <h2 id="部署"><a href="#部署" class="header-anchor">#</a> 部署</h2> <h3 id="服务端部署"><a href="#服务端部署" class="header-anchor">#</a> 服务端部署</h3> <h4 id="nodejs-环境"><a href="#nodejs-环境" class="header-anchor">#</a> nodejs 环境</h4> <p>我们默认你的服务端具有了 nodejs 环境，你可以通过搜索引擎查找如何安装。</p> <p>一个便捷的方法：如果你使用了宝塔服务面板，可以在 软件商店 &gt; 安装 PM2 管理器，之后会附带安装好 nodejs 环境。</p> <h4 id="拉取项目"><a href="#拉取项目" class="header-anchor">#</a> 拉取项目</h4> <p>通过 <code>git clone</code> 或者从 <a href="https://github.com/fz6m/5000choyen-server" target="_blank" rel="noopener noreferrer">项目处<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 下载压缩包的方式，将服务端下载到本地。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>    <span class="token function">git</span> clone https://github.com/fz6m/5000choyen-server.git
</code></pre></div><h4 id="安装依赖"><a href="#安装依赖" class="header-anchor">#</a> 安装依赖</h4> <p>之后进入该项目根目录，执行依赖安装：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>    <span class="token comment"># 设定 npm 下载源为 taobao 源，否则下载会很卡</span>
    <span class="token function">npm</span> config <span class="token builtin class-name">set</span> registry https://registry.npm.taobao.org
    <span class="token comment"># 安装 yarn </span>
    <span class="token function">npm</span> <span class="token function">install</span> -g <span class="token function">yarn</span>

    <span class="token comment"># 设定 yarn 下载源为 taobao 源，否则下载会很卡</span>
    <span class="token function">yarn</span> config <span class="token builtin class-name">set</span> registry https://registry.npm.taobao.org
    <span class="token comment"># 使用 yarn 安装依赖</span>
    <span class="token function">yarn</span>
</code></pre></div><p>注：假如最后一步使用 <code>yarn</code> 命令安装依赖卡住很久不动，或者失败，请使用如下命令安装依赖</p> <div class="language-bash extra-class"><pre class="language-bash"><code>    <span class="token comment"># 使用 yarn 安装出问题时，改为编译安装依赖</span>
    <span class="token assign-left variable">npm_config_build_from_source</span><span class="token operator">=</span>true <span class="token function">yarn</span> <span class="token function">install</span>
</code></pre></div><p>假如你还有问题，一般是在比较旧的服务器上安装 <code>canvas</code> 这个依赖时发生了问题，你可以选择：</p> <ol><li><p>我对 nodejs 有一定了解，可以自行通过搜索解决安装 <code>canvas</code> 失败的问题</p></li> <li><p>我对 nodejs 没有了解，也不想解决，请放弃使用此插件</p></li></ol> <h4 id="启动项目"><a href="#启动项目" class="header-anchor">#</a> 启动项目</h4> <h5 id="使用-tmux-启动"><a href="#使用-tmux-启动" class="header-anchor">#</a> 使用 tmux 启动</h5> <p>tmux 是一个多窗口隔离管理工具，如果你并不熟悉，可以先学习教程：<a href="http://www.ruanyifeng.com/blog/2019/10/tmux.html" target="_blank" rel="noopener noreferrer">阮一峰 Tmux 使用教程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>为了保证该服务端在后台运行，新建一个 tmux ，并跳转到已经安装好依赖的该项目根目录下，执行：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>    <span class="token comment"># 启动项目</span>
    <span class="token function">yarn</span> server
</code></pre></div><p>之后 <code>ctrl + b + d</code> 分离 tmux 会话，大功告成。</p> <h5 id="使用-pm2-启动"><a href="#使用-pm2-启动" class="header-anchor">#</a> 使用 pm2 启动</h5> <p>如果你追求更好的服务稳定性，可以采用 pm2 启动。</p> <ol><li><p>先在项目根目录新建一个 <code>run.sh</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code>    <span class="token function">yarn</span> server
</code></pre></div></li> <li><p>赋予该脚本运行权限，之后使用 pm2 启动该脚本即可</p></li></ol> <h3 id="python-插件部署"><a href="#python-插件部署" class="header-anchor">#</a> python 插件部署</h3> <h4 id="新建插件"><a href="#新建插件" class="header-anchor">#</a> 新建插件</h4> <p>服务端部署好后，在机器人插件目录的 <code>plugins</code> 文件夹下新建该 <code>bot_5000_choyen.py</code> 插件：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># -*- coding:utf-8 -*-</span>

<span class="token keyword">import</span> base64
<span class="token keyword">import</span> os
<span class="token keyword">from</span> enum <span class="token keyword">import</span> Enum
<span class="token keyword">from</span> io <span class="token keyword">import</span> BytesIO

<span class="token keyword">import</span> httpx
<span class="token keyword">from</span> botoy <span class="token keyword">import</span> Action<span class="token punctuation">,</span> GroupMsg
<span class="token keyword">from</span> botoy<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> ignore_botself
<span class="token keyword">from</span> botoy<span class="token punctuation">.</span>collection <span class="token keyword">import</span> MsgTypes
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image

<span class="token comment"># ==========================================</span>
RESOURCES_BASE_PATH <span class="token operator">=</span> <span class="token string">&quot;./resources/5000-choyen&quot;</span>
<span class="token comment"># ==========================================</span>

bot <span class="token operator">=</span> Action<span class="token punctuation">(</span>
    <span class="token comment"># 注意更换您的 bot.py 文件为最新</span>
    <span class="token builtin">int</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">&quot;BOTQQ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@ignore_botself</span>
<span class="token keyword">def</span> <span class="token function">receive_group_msg</span><span class="token punctuation">(</span>ctx<span class="token punctuation">:</span> GroupMsg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    userGroup <span class="token operator">=</span> ctx<span class="token punctuation">.</span>FromGroupId

    <span class="token keyword">if</span> <span class="token keyword">not</span> Tools<span class="token punctuation">.</span>textOnly<span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>MsgType<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span>

    userQQ <span class="token operator">=</span> ctx<span class="token punctuation">.</span>FromUserId
    msg <span class="token operator">=</span> ctx<span class="token punctuation">.</span>Content

    mainProgram<span class="token punctuation">(</span>msg<span class="token punctuation">,</span> bot<span class="token punctuation">,</span> userQQ<span class="token punctuation">,</span> userGroup<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Status</span><span class="token punctuation">(</span>Enum<span class="token punctuation">)</span><span class="token punctuation">:</span>

    SUCCESS <span class="token operator">=</span> <span class="token string">&quot;_success&quot;</span>

    FAILURE <span class="token operator">=</span> <span class="token string">&quot;_failure&quot;</span>

<span class="token keyword">class</span> <span class="token class-name">Tools</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@staticmethod</span>
    <span class="token keyword">def</span> <span class="token function">textOnly</span><span class="token punctuation">(</span>msgType<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> msgType <span class="token operator">==</span> MsgTypes<span class="token punctuation">.</span>TextMsg

    <span class="token decorator annotation punctuation">@staticmethod</span>
    <span class="token keyword">def</span> <span class="token function">readPictureFile</span><span class="token punctuation">(</span>picPath<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>picPath<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> Status<span class="token punctuation">.</span>FAILURE
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>picPath<span class="token punctuation">,</span> <span class="token string">&quot;rb&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            <span class="token keyword">return</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token decorator annotation punctuation">@classmethod</span>
    <span class="token keyword">def</span> <span class="token function">base64conversion</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> picPath<span class="token punctuation">)</span><span class="token punctuation">:</span>
        picByte <span class="token operator">=</span> cls<span class="token punctuation">.</span>readPictureFile<span class="token punctuation">(</span>picPath<span class="token punctuation">)</span>
        <span class="token keyword">if</span> picByte <span class="token operator">==</span> Status<span class="token punctuation">.</span>FAILURE<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">&quot;图片文件不存在！&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>picByte<span class="token punctuation">)</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span>

    <span class="token decorator annotation punctuation">@classmethod</span>
    <span class="token keyword">def</span> <span class="token function">sendPictures</span><span class="token punctuation">(</span>
        cls<span class="token punctuation">,</span> userGroup<span class="token punctuation">,</span> picPath<span class="token punctuation">,</span> bot<span class="token punctuation">:</span> Action<span class="token punctuation">,</span> standardization<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> content<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> atUser<span class="token operator">=</span><span class="token number">0</span>
    <span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> standardization<span class="token punctuation">:</span>
            content <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;[PICFLAG]&quot;</span>
        bot<span class="token punctuation">.</span>sendGroupPic<span class="token punctuation">(</span>
            userGroup<span class="token punctuation">,</span>
            content<span class="token operator">=</span>content<span class="token punctuation">,</span>
            picBase64Buf<span class="token operator">=</span>cls<span class="token punctuation">.</span>base64conversion<span class="token punctuation">(</span>picPath<span class="token punctuation">)</span><span class="token punctuation">,</span>
            atUser<span class="token operator">=</span>atUser<span class="token punctuation">,</span>
        <span class="token punctuation">)</span>

    <span class="token decorator annotation punctuation">@staticmethod</span>
    <span class="token keyword">def</span> <span class="token function">checkFolder</span><span class="token punctuation">(</span><span class="token builtin">dir</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token builtin">dir</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span><span class="token builtin">dir</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Network</span><span class="token punctuation">:</span>

    DEFAULT_HEADERS <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;User-Agent&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.94 Safari/537.36&quot;</span>
    <span class="token punctuation">}</span>

    <span class="token decorator annotation punctuation">@classmethod</span>
    <span class="token keyword">def</span> <span class="token function">getBytes</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> url<span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> headers <span class="token operator">==</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">:</span>
            headers <span class="token operator">=</span> cls<span class="token punctuation">.</span>DEFAULT_HEADERS
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> httpx<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> timeout<span class="token operator">=</span>timeout<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> Status<span class="token punctuation">.</span>FAILURE

<span class="token keyword">def</span> <span class="token function">getPictures</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
    img <span class="token operator">=</span> Network<span class="token punctuation">.</span>getBytes<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    <span class="token keyword">return</span> img

<span class="token keyword">def</span> <span class="token function">mainProgram</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> bot<span class="token punctuation">,</span> userQQ<span class="token punctuation">,</span> userGroup<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        msg_list <span class="token operator">=</span> msg<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>
        first_msg <span class="token operator">=</span> msg_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

        <span class="token comment"># 触发的第一个关键词</span>
        <span class="token keyword">if</span> first_msg <span class="token operator">==</span> <span class="token string">'5000'</span><span class="token punctuation">:</span>
            length <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>msg_list<span class="token punctuation">)</span>
            <span class="token keyword">if</span> length <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span>
            <span class="token comment"># &gt;= 2</span>
            <span class="token comment"># set top</span>
            top_text <span class="token operator">=</span> msg_list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
            <span class="token comment"># set bottom</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                bottom_text <span class="token operator">=</span> msg_list<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
            <span class="token keyword">except</span><span class="token punctuation">:</span>
                bottom_text <span class="token operator">=</span> <span class="token boolean">None</span>
            <span class="token comment"># set offset</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                offset <span class="token operator">=</span> msg_list<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
            <span class="token keyword">except</span><span class="token punctuation">:</span>
                offset <span class="token operator">=</span> <span class="token boolean">None</span>

            <span class="token comment"># download</span>
            url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'http://127.0.0.1:4000/api/v1/gen?top=</span><span class="token interpolation"><span class="token punctuation">{</span>top_text<span class="token punctuation">}</span></span><span class="token string">'</span></span>
            <span class="token keyword">if</span> bottom_text<span class="token punctuation">:</span>
                url <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f'&amp;bottom=</span><span class="token interpolation"><span class="token punctuation">{</span>bottom_text<span class="token punctuation">}</span></span><span class="token string">'</span></span>
            <span class="token keyword">if</span> offset<span class="token punctuation">:</span>
                url <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f'&amp;offset=</span><span class="token interpolation"><span class="token punctuation">{</span>offset<span class="token punctuation">}</span></span><span class="token string">'</span></span>
            url <span class="token operator">+=</span> <span class="token string">'&amp;format=png'</span>

            img <span class="token operator">=</span> getPictures<span class="token punctuation">(</span>url<span class="token punctuation">)</span>

            resource_folder <span class="token operator">=</span> RESOURCES_BASE_PATH
            Tools<span class="token punctuation">.</span>checkFolder<span class="token punctuation">(</span>resource_folder<span class="token punctuation">)</span>

            cache_folder <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>RESOURCES_BASE_PATH<span class="token punctuation">}</span></span><span class="token string">/cache'</span></span>
            Tools<span class="token punctuation">.</span>checkFolder<span class="token punctuation">(</span>cache_folder<span class="token punctuation">)</span>

            save_path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>cache_folder<span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span>userQQ<span class="token punctuation">}</span></span><span class="token string">.png'</span></span>
            Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>BytesIO<span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>save<span class="token punctuation">(</span>save_path<span class="token punctuation">)</span>

            Tools<span class="token punctuation">.</span>sendPictures<span class="token punctuation">(</span>
                userGroup<span class="token operator">=</span>userGroup<span class="token punctuation">,</span> picPath<span class="token operator">=</span>save_path<span class="token punctuation">,</span> bot<span class="token operator">=</span>bot
            <span class="token punctuation">)</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span>
</code></pre></div><p>这段代码并没有提供在 <code>opqqq-plugin</code> 仓库中，需要你自己新建。</p> <h4 id="安装依赖-2"><a href="#安装依赖-2" class="header-anchor">#</a> 安装依赖</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>    pip <span class="token function">install</span> httpx
    pip <span class="token function">install</span> pillow
</code></pre></div><p>注：如果您下载依赖太慢，可选用大清源加速，例：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>    pip <span class="token function">install</span> -i https://pypi.tuna.tsinghua.edu.cn/simple pillow
</code></pre></div><h4 id="使用插件"><a href="#使用插件" class="header-anchor">#</a> 使用插件</h4> <p>一切准备就绪，可以启动机器人通过如下命令使用：</p> <div class="language-yml extra-class"><pre class="language-yml"><code>    <span class="token comment"># 只有单行红字</span>
    5000 单行文字
    <span class="token comment"># 上下两行文字</span>
    5000 上部文字 下部文字
    <span class="token comment"># 第二行下部文字向右额外偏移 100 像素</span>
    5000 上部文字 下部文字 100
</code></pre></div><h2 id="自定义配置项"><a href="#自定义配置项" class="header-anchor">#</a> 自定义配置项</h2> <h3 id="如何配置触发命令"><a href="#如何配置触发命令" class="header-anchor">#</a> 如何配置触发命令</h3> <p>请阅读上面的 python 插件脚本，稍微改一下判断条件的内容即可。</p> <h3 id="如何修改图片格式"><a href="#如何修改图片格式" class="header-anchor">#</a> 如何修改图片格式</h3> <p>默认发送 <code>png</code> 格式的图片，如果服务器带宽不够可以换为 <code>jpg</code> 格式，将请求 url 中的 <code>format</code> 参数换为 <code>format=jpg</code> 即可。</p> <p>全部 url 请求参数可参见服务端说明：<a href="https://github.com/fz6m/5000choyen-server" target="_blank" rel="noopener noreferrer">5000choyen-server<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="其他"><a href="#其他" class="header-anchor">#</a> 其他</h2> <h3 id="注意风控"><a href="#注意风控" class="header-anchor">#</a> 注意风控</h3> <p>假如内鬼经常制造一些带敏感内容的图片，风控风险会比较大。</p> <p>一旦出现消息送不出去的情况，请立即停用机器人一段时间，并永远不再使用该插件！</p> <h3 id="安装过程问题太多搞不明白了"><a href="#安装过程问题太多搞不明白了" class="header-anchor">#</a> 安装过程问题太多搞不明白了</h3> <p>此插件使用成本较高，不适合小小白使用。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">5/9/2021, 5:16:58 AM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/opqqq-plugin-press/assets/js/app.0581ffdb.js" defer></script><script src="/opqqq-plugin-press/assets/js/2.ca183b19.js" defer></script><script src="/opqqq-plugin-press/assets/js/12.5917bece.js" defer></script>
  </body>
</html>
